# 优化问题构造与非凸优化方法指南

## 目录
1. [目标函数的构造](#1-目标函数的构造)
2. [约束条件的设置](#2-约束条件的设置)
3. [非凸优化方法](#3-非凸优化方法)
4. [实际案例分析](#4-实际案例分析)
5. [实现技巧与注意事项](#5-实现技巧与注意事项)

---

## 1. 目标函数的构造

### 1.1 目标函数的基本概念
目标函数（Objective Function）是优化问题的核心，表示我们想要最大化或最小化的量。

### 1.2 构造目标函数的步骤

#### 步骤1：识别优化目标
- **性能指标**：确定系统最重要的性能度量
- **权衡关系**：识别多个目标之间的权衡
- **可量化性**：确保目标可以用数学表达式表示

#### 步骤2：数学建模
```
f(x) = primary_objective(x) + λ₁·penalty₁(x) + λ₂·penalty₂(x) + ...
```

#### 步骤3：常见的目标函数形式

| 类型 | 表达式 | 应用场景 |
|-----|--------|---------|
| 线性 | f(x) = cᵀx | 线性规划、资源分配 |
| 二次 | f(x) = xᵀQx + cᵀx | 最小二乘、投资组合优化 |
| 对数 | f(x) = log(g(x)) | 信息论、最大似然估计 |
| 指数 | f(x) = exp(g(x)) | 风险管理、鲁棒优化 |
| 比率 | f(x) = g(x)/h(x) | 效率优化、信噪比最大化 |

### 1.3 多目标优化
当有多个相互冲突的目标时：

1. **加权和方法**：
   ```
   f(x) = w₁f₁(x) + w₂f₂(x) + ... + wₙfₙ(x)
   ```

2. **ε-约束方法**：
   ```
   min f₁(x)
   s.t. f₂(x) ≤ ε₂, f₃(x) ≤ ε₃, ...
   ```

3. **目标规划**：
   ```
   min Σᵢ(|fᵢ(x) - targetᵢ|)
   ```

## 2. 约束条件的设置

### 2.1 约束类型

#### 2.1.1 等式约束
```
h(x) = 0
```
示例：
- 功率守恒：Σᵢ Pᵢ = P_total
- 单位范数：‖w‖₂ = 1

#### 2.1.2 不等式约束
```
g(x) ≤ 0
```
示例：
- 功率限制：0 ≤ P ≤ P_max
- 质量保证：QoS(x) ≥ QoS_min

#### 2.1.3 箱式约束
```
l ≤ x ≤ u
```

### 2.2 约束建模技巧

1. **松弛技术**：将硬约束转化为软约束
   ```
   原始：g(x) ≤ 0
   松弛：min f(x) + μ·max(0, g(x))
   ```

2. **约束聚合**：减少约束数量
   ```
   替代多个约束：g₁(x) ≤ 0, g₂(x) ≤ 0, ...
   使用：max(g₁(x), g₂(x), ...) ≤ 0
   ```

3. **约束规范化**：改善数值稳定性
   ```
   原始：1000x₁ + 0.001x₂ ≤ 5000
   规范化：x₁ + 0.000001x₂ ≤ 5
   ```

## 3. 非凸优化方法

### 3.1 非凸性的来源

1. **非凸目标函数**：
   - 差分凸函数：f(x) - g(x)（两个凸函数之差）
   - 比率函数：f(x)/g(x)
   - 组合函数：max{f₁(x), f₂(x)}

2. **非凸约束**：
   - 双线性项：xᵀy
   - 秩约束：rank(X) = r
   - 整数约束：x ∈ {0,1}

### 3.2 非凸优化算法

#### 3.2.1 局部搜索方法

1. **梯度下降及其变体**
   ```python
   # 基本梯度下降
   x_{k+1} = x_k - α∇f(x_k)
   
   # 动量方法
   v_{k+1} = βv_k + ∇f(x_k)
   x_{k+1} = x_k - αv_{k+1}
   ```

2. **牛顿法和拟牛顿法**
   ```
   x_{k+1} = x_k - H⁻¹∇f(x_k)
   ```

#### 3.2.2 全局优化方法

1. **分支定界（Branch and Bound）**
   - 将问题分解为子问题
   - 计算上下界
   - 剪枝不可行分支

2. **凸松弛（Convex Relaxation）**
   ```
   原始问题：min f(x), s.t. x ∈ S (非凸)
   松弛问题：min f̃(x), s.t. x ∈ conv(S) (凸)
   ```

3. **半定规划松弛（SDP Relaxation）**
   ```
   原始：xxᵀ (秩1约束)
   松弛：X ⪰ 0 (半正定约束)
   ```

#### 3.2.3 启发式和元启发式

1. **模拟退火（Simulated Annealing）**
   ```python
   if f(x_new) < f(x_current) or random() < exp(-(f(x_new)-f(x_current))/T):
       x_current = x_new
   ```

2. **遗传算法（Genetic Algorithm）**
   - 选择、交叉、变异操作
   - 种群进化

3. **粒子群优化（PSO）**
   ```
   v_i = w·v_i + c₁·r₁·(p_best_i - x_i) + c₂·r₂·(g_best - x_i)
   x_i = x_i + v_i
   ```

#### 3.2.4 交替优化（Alternating Optimization）

当变量可分组时：
```
Step 1: 固定 y，优化 x
Step 2: 固定 x，优化 y
重复直到收敛
```

### 3.3 凸凹过程（DC Programming）

对于 f(x) = g(x) - h(x) 形式（g和h都是凸函数）：

```
DC算法：
x_{k+1} = argmin{g(x) - h(x_k) - ⟨∇h(x_k), x-x_k⟩}
```

## 4. 实际案例分析

### 4.1 保密率最大化问题（基于项目）

**目标函数**：
```
SR = [R_R - R_E]⁺ = [log₂(1 + SNR_R) - log₂(1 + SNR_E)]⁺
```

**非凸性分析**：
- 差分对数函数（DC结构）
- 双线性项：wᵀh 和 vᵀh

**约束条件**：
1. 单位范数：‖w‖₂ = ‖v‖₂ = 1
2. 能量收集：P_L,avg ≥ P_th
3. 调制指数：|Γ₀ - Γ₁| ≥ 2m_th
4. 反射系数：|Γᵢ| ≤ 1

**求解策略**：
1. 外层：网格搜索或Dinkelbach方法处理(Γ₀, Γ₁)
2. 内层：SDP松弛处理波束成形向量
3. 秩1恢复：主特征向量或高斯随机化

### 4.2 实现示例（MATLAB/CVX）

```matlab
% 使用CVX求解SDP松弛
cvx_begin sdp
    variable W(N,N) hermitian
    variable V(N,N) hermitian
    
    maximize( log_det(I + SNR_R*W) - log_det(I + SNR_E*W) )
    
    subject to
        trace(W) == 1;  % 功率约束
        trace(V) == 1;
        W >= 0;         % 半正定约束
        V >= 0;
        % 其他约束...
cvx_end

% 秩1恢复
[U,S,~] = svd(W);
w = sqrt(S(1,1)) * U(:,1);
```

## 5. 实现技巧与注意事项

### 5.1 数值稳定性
1. **缩放变量**：避免数值过大或过小
2. **预处理**：归一化数据
3. **条件数监控**：检查矩阵条件数

### 5.2 初始化策略
1. **可行点初始化**：确保初始点满足所有约束
2. **多起点策略**：使用多个随机初始点
3. **热启动**：利用相似问题的解

### 5.3 收敛准则
```matlab
% 相对变化
if norm(x_new - x_old) / norm(x_old) < tol
    break;
end

% 目标函数变化
if abs(f_new - f_old) / abs(f_old) < tol
    break;
end
```

### 5.4 算法选择指南

| 问题特征 | 推荐算法 |
|---------|---------|
| 小规模、高精度 | 分支定界、SDP |
| 大规模、凸 | 一阶方法（梯度下降） |
| 大规模、非凸 | 交替优化、DC算法 |
| 离散变量 | 整数规划、启发式 |
| 黑盒优化 | 贝叶斯优化、进化算法 |

### 5.5 常用优化工具

1. **MATLAB工具箱**：
   - CVX：凸优化
   - YALMIP：通用建模
   - Gurobi/CPLEX：混合整数规划

2. **Python库**：
   - CVXPY：凸优化
   - Pyomo：通用建模
   - SciPy.optimize：科学计算

3. **专用求解器**：
   - IPOPT：非线性规划
   - BARON：全局优化
   - SCIP：混合整数非线性规划

---

## 总结

构造和求解优化问题是一个迭代过程：
1. 明确目标和约束
2. 建立数学模型
3. 分析凸性/非凸性
4. 选择合适的算法
5. 实现并调试
6. 验证和改进

成功的关键在于深入理解问题结构，选择合适的建模和求解方法，以及仔细的数值实现。